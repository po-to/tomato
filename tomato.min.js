var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports"],function(t,e){"use strict";function i(t,e){for(var i=0,n=t;i<n.length;i++){var o=n[i];if(e(o))return o}}function n(t,e){for(var i=0,n=t.length;i<n;i++)if(e(t[i]))return i;return-1}function o(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=0,o=e;n<o.length;n++){var s=o[n];for(var r in s)s.hasOwnProperty(r)&&(t[r]=s[r])}return t}function s(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e.forEach(function(e){delete t[e]}),t}function r(t){w||(w=setTimeout(function(){w=0,e.application.eachChildren(function(t){t.updateProp()})},0))}function a(t){return"function"==typeof t.getVID&&"function"==typeof t.getVCON&&"function"==typeof t.setVID&&"function"==typeof t.getSUBS&&"function"==typeof t.removeChild&&"function"==typeof t.appendChild&&"function"==typeof t.removeClass&&"function"==typeof t.addClass}function c(e){try{return t(e)}catch(i){return new Promise(function(i,n){t([e],function(t){i(t)},function(t){n(t)})})}}function u(t,e,i){return void 0===e&&(e=void 0),void 0===i&&(i=!0),x(t,e,i)}function h(t,e,i){void 0===e&&(e=void 0),void 0===i&&(i=!0);var n=x(t,e,i);return n instanceof Promise?n:Promise.resolve(n)}function l(t,e,i){return void 0===e&&(e=void 0),void 0===i&&(i=!0),x(t,e,i)}function p(t,e,i){window.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function d(){var t=!!window.history.pushState,e=Date.now(),i="#undo@"+e,n="#redo@"+e,o=window.location.hash;o=o||"#";var s=!1;t?(window.history.replaceState("","back",i),window.history.pushState("","",o),window.history.pushState("","forward",n)):(window.location.replace(i),window.location.href=o,window.location.href=n);var r=function(t){window.setTimeout(function(){},0)};window.setTimeout(function(){p(window,"hashchange",function(t){if(console.log("hash",window.location.hash),console.log(t),s)return s=!1,r(),!0}),s=!0,window.history.go(-1)},0)}function f(t){t.namespace&&(e.namespace=t.namespace),t.createViewComponent&&(T=t.createViewComponent),t.application&&(e.application=t.application,_(e.application))}function _(t){A!=t&&(A==e.application&&(e.application.history.push(new B),e.application.history.go(-1)),A&&A.viewComponent.removeClass("pt-topDialog"),A=t,A.viewComponent.addClass("pt-topDialog"))}function v(){return A}Object.defineProperty(e,"__esModule",{value:!0});e.namespace="po-to/tomato",e.TaskCountEvent={Added:"TaskCountEvent.Added",Completed:"TaskCountEvent.Completed",Busy:"TaskCountEvent.Busy",Free:"TaskCountEvent.Free"},e.ViewEvent={Installed:"ViewEvent.Installed",Uninstalled:"ViewEvent.Uninstalled",ChildAppended:"ViewEvent.ChildAppended",ChildRemoved:"ViewEvent.ChildRemoved",Inited:"ViewEvent.Inited"};var m;!function(t){t[t.Invalid=0]="Invalid",t[t.Computing=1]="Computing",t[t.Updated=2]="Updated"}(m=e.PropState||(e.PropState={})),e.DialogEvent={Focused:"DialogEvent.Focused",Blured:"DialogEvent.Blured",Closed:"DialogEvent.Closed"},e.CmdEvent={ItemSuccess:"CmdEvent.ItemSuccess",ItemFailure:"CmdEvent.ItemFailure",CmdSuccess:"CmdEvent.CmdSuccess",CmdFailure:"CmdEvent.CmdFailure",Failure:"CmdEvent.Failure",Success:"CmdEvent.Success",Complete:"CmdEvent.Complete",Overflow:"CmdEvent.Overflow"};!function(t){t[t.children=0]="children",t[t.parent=1]="parent"}(e.SizeDependOn||(e.SizeDependOn={}));var C=function(){function t(t,e,i){void 0===i&&(i=!1),this.name=t,this.data=e,this.bubbling=i}return t.prototype.setTarget=function(t){this.target=t},t.prototype.setCurrentTarget=function(t){this.currentTarget=t},t}();e.PEvent=C;var y=function(t){function i(e,i,n){void 0===i&&(i="tomato.PError");var o=t.call(this,e+i)||this;return o.name=e,o.note=i,o.data=n,o}return __extends(i,t),i.prototype.getNamespace=function(){return e.namespace},i}(Error);e.PError=y;var w=0;e.invalidProp=r;var g=function(){function t(t){this.parent=t,this._handlers={}}return t.prototype.addListener=function(t,e){var i=this._handlers[t];return i||(this._handlers[t]=i=[]),i.push(e),this},t.prototype.removeListener=function(t,e){if(t){var i=this._handlers;if(i.propertyIsEnumerable(t)){var n=i[t];if(e){var o=n.indexOf(e);o>-1&&n.splice(o,1),0==n.length&&delete i[t]}else delete i[t]}}else s(this._handlers);return this},t.prototype.dispatch=function(t){t.target||t.setTarget(this),t.setCurrentTarget(this);var e=this._handlers[t.name];if(e)for(var i=0,n=e.length;i<n;i++)e[i](t);return this.parent&&t.bubbling&&this.parent.dispatch(t),this},t.prototype.setParent=function(t){return this.parent=t,this},t}();e.PDispatcher=g;var I;!function(t){t[t.Free=0]="Free",t[t.Busy=1]="Busy"}(I=e.TaskCounterState||(e.TaskCounterState={}));var E=function(t){function i(e){var i=t.call(this)||this;return i.deferSecond=e,i.list=[],i.state=I.Free,i}return __extends(i,t),i.prototype.addItem=function(t,i){var n=this;return void 0===i&&(i=""),this.list.some(function(e){return e.promise===t})||(this.list.push({promise:t,note:i}),t.then(function(e){return n._completeItem(t)},function(e){return n._completeItem(t)}),this.dispatch(new C(e.TaskCountEvent.Added)),this._timer||(this._timer=window.setTimeout(function(){n._timer=0,n.list.length>0&&n.state==I.Free&&(n.state=I.Busy,n.dispatch(new C(e.TaskCountEvent.Busy)))},1e3*this.deferSecond))),t},i.prototype._completeItem=function(t){var i=n(this.list,function(e){return e.promise===t});return i>-1&&(this.list.splice(i,1),this.dispatch(new C(e.TaskCountEvent.Completed)),0==this.list.length&&(this._timer&&(clearTimeout(this._timer),this._timer=0),this.state==I.Busy&&(this.state=I.Free,this.dispatch(new C(e.TaskCountEvent.Free))))),this},i}(g);e.TaskCounter=E,e.taskCounter=new E(3);var T=function(t){return{}},k=function(t){function i(e,i,n){var o=t.call(this,i)||this;return o.viewComponent=e,o.children=[],o.vid="",o._propState={},o._propValue={},o._eventToAction=null,n&&(o.vid=n.split("?")[0].replace(/\/+$/,"")),o.vid&&(S[o.vid]=o),o.initialization=o._init(),o}return __extends(i,t),i.prototype._init=function(){var t=this,e=!1,i=this.viewComponent.getSUBS().map(function(i){var n=x(i,t,!0);return!e&&n instanceof Promise&&(e=!0),n});return i.length&&e?Promise.all(i).then(function(e){return(i=t.children).push.apply(i,e),t._inited(),t;var i}):((n=this.children).push.apply(n,i),this._inited(),null);var n},i.prototype._inited=function(){this.dispatch(new C(e.ViewEvent.Inited))},i.prototype._triggerEvent=function(t,e,i){var n=this._eventToAction||this,o=n[t];return"function"!=typeof o||!!o.call(this,e,i)},i.prototype._allowInstallTo=function(t,e){return!0},i.prototype._allowUninstallTo=function(t,e){return!0},i.prototype._allowAppendChild=function(t,e){if(t instanceof b){if(!(this instanceof b))return!1;if(t.state!=F.Closed)return!1}return!0},i.prototype._allowRemoveChild=function(t,e){return!0},i.prototype._beforeInstallTo=function(t,e){},i.prototype._beforeUninstallTo=function(t,e){},i.prototype._afterInstallTo=function(t,e){},i.prototype._afterUninstallTo=function(t,e){},i.prototype._afterRemoveChild=function(t,e){},i.prototype._afterAppendChild=function(t,e){},i.prototype._beforeRemoveChild=function(t,e){},i.prototype._beforeAppendChild=function(t,e){},i.prototype._appendViewComponent=function(t,e){this.viewComponent.appendChild(t.viewComponent)},i.prototype._removeViewComponent=function(t,e){this.viewComponent.removeChild(t.viewComponent)},i.prototype._checkRemoveChild=function(t,e){return t.parent!=this||!(!t._allowUninstallTo(this,e)||!this._allowRemoveChild(t,e))},i.prototype.removeChild=function(t,i,n){return t.parent==this&&(!(!n&&!this._checkRemoveChild(t,i))&&(this._beforeRemoveChild(t,i),t._beforeUninstallTo(this,i),this.children.splice(this.children.indexOf(t),1),this._removeViewComponent(t,i),t.setParent(void 0),this._afterRemoveChild(t,i),t._afterUninstallTo(this,i),this.dispatch(new C(e.ViewEvent.ChildRemoved,i)),t.dispatch(new C(e.ViewEvent.Uninstalled,i)),!0))},i.prototype._checkAppendChild=function(t,e){return t.parent==this||!!(t._allowInstallTo(this,e)&&this._allowAppendChild(t,e)&&(!t.parent||t._allowUninstallTo(this,e)&&t.parent._allowRemoveChild(t,e)))},i.prototype.getDialog=function(){for(var t=this.parent;t;){if(t instanceof b)return t;t=t.parent}return e.application},i.prototype.appendChild=function(t,i,n){return t.parent!=this&&(!(!n&&!this._checkAppendChild(t,i))&&(t.parent&&t.parent.removeChild(t,i,!0),this._beforeAppendChild(t,i),t._beforeInstallTo(this,i),t.setParent(this),this.children.push(t),this._appendViewComponent(t,i),this._afterAppendChild(t,i),t._afterInstallTo(this,i),this.dispatch(new C(e.ViewEvent.ChildAppended,i)),t.dispatch(new C(e.ViewEvent.Installed,i)),!0))},i.prototype.replaceChild=function(t,e,i,n){if(t.parent==this)return!1;if(!n&&!this._checkAppendChild(t,i))return!1;if(e&&e.parent==this){if(!n&&!this._checkRemoveChild(e,i))return!1;this.removeChild(e,i,!0)}return this.appendChild(t,i,!0)},i.prototype.destroy=function(){this.vid&&delete S[this.vid]},i.prototype.eachChildren=function(t,e){e&&t(this),this.children.length&&this.children.forEach(function(e){e.eachChildren(t,!0)})},i.prototype.invalidProp=function(t){this._propState[t]!=m.Invalid&&(this._propState[t]=m.Invalid,r(this))},i.prototype.getProp=function(t,e){var i=this._propState[t];if(i==m.Invalid){if(e)return this._propValue[t];throw this.vid+"."+t+" is invalid"}if(i==m.Computing){if(e)return this._propValue[t];throw this.vid+"."+t+" is loop dependency"}return i==m.Updated?(this._propState[t]=m.Computing,this._propValue[t]=this._computeProp(t),delete this._propState[t],this._propValue[t]):this._propValue[t]},i.prototype._computeProp=function(t){return""},i.prototype.updateProp=function(){for(var t in this._propState)this._propState[t]==m.Invalid&&(this._propState[t]=m.Updated)},i}(g);e.View=k;var S={},x=function(t){function i(t){return T(t)}function n(t,e,i,n,o){var s=new t(e,n,i);return o&&s.initialization?s.initialization:s}function o(t,e,i,o){if(!a(t))throw console.log(t),"is not a IViewComponent";var s=t.getVCON();if(s){var r=c(s);return r instanceof Promise?r.then(function(s){return n(s,t,e,i,o)}):n(r,t,e,i,o)}return n(k,t,e,i,o)}function s(t,e,n,s){if(t)return o(t,e,n,s);if(e){var r=c(e);return r instanceof Promise?r.then(function(t){return o(i(t),e,n,s)}):o(i(r),e,n,s)}throw"not found component and url !"}return function(i,n,o){void 0===n&&(n=void 0),void 0===o&&(o=!0);var r,a,c;"string"!=typeof i?(c=i,a=i.getVID()):(c=null,a=i),r=a,a=a.split("?")[0].replace(/\/+$/,"");var u=t[a];if(u instanceof k)return u;if(u instanceof Promise)return u;var h=s(c,r,n,o);return h instanceof Promise&&(t[a]=h,h.catch(function(e){delete t[a],console.log(r+":"+e)}),e.taskCounter.addItem(h,"load:"+r)),h}}(S);e.syncGetView=u,e.asyncGetView=h,e.getView=l;var F;!function(t){t[t.Focused=0]="Focused",t[t.Blured=1]="Blured",t[t.Closed=2]="Closed"}(F=e.DialogState||(e.DialogState={})),e.DialogEffect={scale:"scale"},e.DialogPosition={left:"left",right:"right",center:"center",top:"top",bottom:"bottom",middle:"middle"};var P={className:"",masked:!1,fixedBackground:!0,x:e.DialogPosition.center,y:e.DialogPosition.middle,width:"50%",height:"50%",offsetX:"",offsetY:"",effect:e.DialogEffect.scale},b=function(t){function i(i,n){var o=t.call(this,i.viewComponent,void 0)||this;return o.history=new U,o.state=F.Closed,o._dialogList=[],o._zindex=-1,o.config=P,o.dialog=i.dialog,o.mask=i.mask,o.body=i.body,o.viewComponent.addClass("pt-layer pt-"+F[o.state]),o.dialog.addClass("pt-dialog"),o.mask.addClass("pt-mask"),o.body.addClass("pt-body"),n&&o.setConfig(n),o.history.addListener(e.CmdEvent.Overflow,function(t){o._onHistoryOverflow(t)}),o}return __extends(i,t),i.prototype._onHistoryOverflow=function(t){this.close()},i.prototype.setConfig=function(t){var e=this.config;this.config=o({},this.config,t),this._afterConfigChange(e)},i.prototype.getZIndex=function(){return this._zindex},i.prototype.getFocusedChild=function(){for(var t=this._dialogList,e=this;t.length;)e=t[t.length-1],t=e._dialogList;return e},i.prototype.eachDialogChildren=function(t,e){e&&t(this),this._dialogList.length&&this._dialogList.forEach(function(e){e.eachDialogChildren(t,!0)})},i.prototype._afterConfigChange=function(t){this.dialog.removeClass(t.className),this.mask.removeClass(t.className),this.viewComponent.removeClass(["pt-"+t.effect,t.masked?"pt-masked":""].join(" "));var e=this.config;this.dialog.addClass(e.className),this.mask.addClass(e.className),this.viewComponent.addClass(["pt-"+e.effect,e.masked?"pt-masked":""].join(" "))},i.prototype._setZIndex=function(t){this._zindex=t,this.viewComponent.setZIndex(t)},i.prototype._countIndex=function(){this._dialogList.forEach(function(t,e){t._setZIndex(e)})},i.prototype._beforeFocus=function(){},i.prototype._afterFocus=function(){},i.prototype._beforeClose=function(){},i.prototype._afterClose=function(){},i.prototype._beforeBlur=function(){},i.prototype._afterBlur=function(){},i.prototype._allowFocus=function(t){return!0},i.prototype._allowBlur=function(){return!0},i.prototype._allowClose=function(){return!0},i.prototype._checkFocus=function(){if(this==e.application)return!0;if(!this.parent)return!1;var t=this.parent;if(this.state!=F.Focused){if(!this._allowFocus())return!1;var i=t._dialogList,n=i[i.length-1];if(n&&n!=this&&!n._allowBlur())return!1}return t._checkFocus()},i.prototype._checkClose=function(){if(this.state==F.Closed)return!0;if(!this.parent)return!1;if(!this._allowClose())return!1;var t=this.parent;if(this.state==F.Focused){var e=t._dialogList,i=e[e.length-2];if(i&&!i._allowFocus(!0))return!1}return!0},i.prototype.focus=function(t,n){if(!t&&!this._checkFocus())return!1;var o=this.parent,s=o._dialogList,r=s[s.length-1],a=!0;if(this.state!=F.Focused&&(r==this&&(r=void 0,a=!1),this._beforeFocus(),a)){if(this.state==F.Blured){var c=s.indexOf(this);c>-1&&s.splice(c,1)}s.push(this),o._countIndex()}if(a&&o.focus(!1,!0),this.state!=F.Focused){r&&r._blur();this.state;this._setState(F.Focused),F.Closed,this._afterFocus(),n||_(this),this.dispatch(new C(e.DialogEvent.Focused)),this.children.forEach(function(t){t instanceof i||t.eachChildren(function(t){t.dispatch(new C(e.DialogEvent.Focused))},!0)})}return!0},i.prototype.close=function(){if(this.state==F.Closed||!this._checkClose())return!1;this._beforeClose();var t=this.parent,n=t._dialogList,o=null;if(n[n.length-1]==this)n.pop(),o=n[n.length-1];else{var s=n.indexOf(this);s>-1&&n.splice(s,1),this._countIndex()}return this._setZIndex(-1),this._setState(F.Closed),this._afterClose(),this.dispatch(new C(e.DialogEvent.Closed)),this.children.forEach(function(t){t instanceof i||t.eachChildren(function(t){t.dispatch(new C(e.DialogEvent.Closed))},!0)}),o&&o.focus(!0),!o&&_(t),!0},i.prototype._blur=function(){this.state!=F.Blured&&(this._beforeBlur(),this._setState(F.Blured),this._afterBlur(),this.dispatch(new C(e.DialogEvent.Blured)),this.children.forEach(function(t){t instanceof i||t.eachChildren(function(t){t.dispatch(new C(e.DialogEvent.Blured))},!0)}))},i.prototype._setState=function(t){this.viewComponent.removeClass("pt-"+F[this.state]),this.state=t,this.viewComponent.addClass("pt-"+F[this.state])},i.prototype.onWindowResize=function(t){},i.prototype._appendViewComponent=function(t,e){t instanceof i?this.viewComponent.appendChild(t.viewComponent):this.body.appendChild(t.viewComponent)},i.prototype._removeViewComponent=function(t,e){t instanceof i?this.viewComponent.removeChild(t.viewComponent):this.body.removeChild(t.viewComponent)},i}(k);e.Dialog=b;var V=function(t){function i(i,n,o){var s=t.call(this,n,o)||this;return s.initTime=Date.now(),s.viewComponent.removeClass("pt-layer").addClass("pt-application"),s._setZIndex(0),s._setState(F.Focused),s.viewComponent.addClass("pt-topDialog"),e.taskCounter.addListener(e.TaskCountEvent.Added,function(t){s.mask.addClass("pt-show")}).addListener(e.TaskCountEvent.Completed,function(t){s.mask.removeClass("pt-show")}).addListener(e.TaskCountEvent.Busy,function(t){s.mask.addClass("pt-busy")}).addListener(e.TaskCountEvent.Free,function(t){s.mask.removeClass("pt-busy")}),i&&s._initHistory(s.initTime,i),s}return __extends(i,t),i.prototype._initHistory=function(t,i){function n(t,i,n,o){u?window.history.pushState(t,i,o?n:"#"+encodeURI(n)):(c=!0,window.location.href="#"+e.namespace+"@"+t+"@"+encodeURI(n))}function o(i,n,o){u?window.history.replaceState(t+"."+i,n||document.title,o||window.location.href):(c=!0,window.location.replace("#"+e.namespace+"@"+t+"."+i+"@"+encodeURI(o||window.location.href)))}function s(e){var i=e.split(".").map(function(t){return parseInt(t)}),n=i[0],o=i[1],s=i[2];if(n==t){var r=h.getCmdByCode(o+"."+s);if(r){var c=h.getCode(),u=c[0],l=c[1],p=u-o+l-s;if(0!=p){var d=document.title;document.title=r.title,a=function(){document.title=d,setTimeout(function(){v().history.go(-p)},1)},window.history.go(p)}}else window.location.reload()}else window.location.reload()}function r(t){a?("function"==typeof a&&a(),a=!1):h.getLength()&&(t.state?s(t.state):(h.added(new D(window.location.href,document.title,!1)),o(h.getCode().join("."))))}var a,c,u=!!window.history.pushState,h=this.history;h._syncHistory=function(e,i){var o=function(){e.push&&(n(t+"."+e.push.code,e.push.title,e.push.url,e.push.isUri),document.title=e.push.title),setTimeout(i,1)};e.move?(a=function(){document.title=e.moveTitle||"",o()},window.history.go(e.move)):o()},u?p(window,"popstate",r):p(window,"hashchange",function(t){if(c)c=!1;else{var i=window.location.hash.split("@");r(i[0]=="#"+e.namespace&&i[1]&&i[2]?{state:i[1]}:{state:""})}}),document.title=i.title,o("1.0",i.title,i.url),this.history.added(i)},i.prototype.close=function(){return!1},i.prototype.focus=function(t){return!1},i}(b);e.Application=V,e.application={};var D=function(t){function i(e,i,n){void 0===n&&(n=!1);var o=t.call(this)||this;return o.url=e,o.title=i,o.isUri=n,o}return __extends(i,t),i.prototype.success=function(){this.dispatch(new C(e.CmdEvent.ItemSuccess,this,!0))},i.prototype.failure=function(){this.dispatch(new C(e.CmdEvent.ItemFailure,this,!0))},i.prototype.execute=function(){console.log("execute()",this.url),this.success()},i.prototype.redo=function(){console.log("redo()",this.url),this.success()},i.prototype.undo=function(){console.log("undo()",this.url),this.success()},i}(g);e.Cmd=D;var B=function(t){function e(){return t.call(this,"dialog",document.title)||this}return __extends(e,t),e.prototype.execute=function(){this.success()},e.prototype.redo=function(){this.failure()},e.prototype.undo=function(){this.success()},e}(D),U=function(t){function n(i){void 0===i&&(i=50);var n=t.call(this,void 0)||this;return n.maxStep=i,n._list=[],n._cache=[],n._cur=[0,0],n._goto=[0,0],n._first=[0,0],n._last=[0,0],n.addListener(e.CmdEvent.ItemSuccess,function(t){t.target.setParent(void 0);var i=function(){n._curItem=void 0,n.dispatch(new C(e.CmdEvent.CmdSuccess)),n.next()},o=n._curItem;o&&(o.cur?(n._cur=o.cur,n._syncHistory({move:o.go,moveTitle:o.curCmd.title},i)):n._syncHistory(n._addHistoryItem(o.cmd),i))}).addListener(e.CmdEvent.ItemFailure,function(t){t.target.setParent(void 0),n._curItem&&(n._goto=[n._cur[0],n._cur[1]],n._cache=[]),n._curItem=void 0,n.dispatch(new C(e.CmdEvent.CmdFailure))}),n}return __extends(n,t),n.prototype.getLength=function(){return this._list.length},n.prototype.getCode=function(){return[this._cur[0],this._cur[1]]},n.prototype._syncHistory=function(t,e){e()},n.prototype._addHistoryItem=function(t){var e=0,i="";if(this._cur.join(".")!=this._first.join(".")){this._list.splice(0,this._first[0]-this._cur[0]+this._first[1]-this._cur[1]);this._first=[this._cur[0],this._cur[1]]}if(t.isUri){if(0!=this._cur[1]){this._list.splice(0,this._cur[1]);e-=this._cur[1],this._cur[1]=0,this._goto[1]=0;i=this.getCmdByCode(this._cur.join(".")).title}this._cur[0]++,this._goto[0]++}else this._cur[1]++,this._goto[1]++;var n={code:this._cur.join("."),cmd:t};this._list.unshift(n),this._list.length>this.maxStep&&(this._list.length=this.maxStep),this._first=[this._cur[0],this._cur[1]];var o=this._list[this._list.length-1],s=o.code.split(".");return this._last=[parseInt(s[0]),parseInt(s[1])],{move:e,moveTitle:i,push:{code:n.code,url:t.url,title:t.title,isUri:t.isUri}}},n.prototype.getCmdByCode=function(t){var e=i(this._list,function(e){return e.code==t});return e?e.cmd:void 0},n.prototype.go=function(t){this._cache.push(t),this.next()},n.prototype.push=function(t){var e=Array.isArray(t)?t:[t];(i=this._cache).push.apply(i,e),this.next();var i},n.prototype.added=function(t){this._addHistoryItem(t)},n.prototype._executeGoto=function(){var t=this._goto,e=this._cur,i=t[0]-e[0];0==i?t[1]<e[1]?(this._curItem={cmd:this.getCmdByCode(e.join(".")),cur:[e[0],e[1]-1],curCmd:this.getCmdByCode([e[0],e[1]-1].join(".")),go:-1},this._curItem.cmd.setParent(this),this._curItem.cmd.undo()):(this._curItem={cmd:this.getCmdByCode([e[0],e[1]+1].join(".")),cur:[e[0],e[1]+1],curCmd:null,go:1},this._curItem.curCmd=this._curItem.cmd,this._curItem.cmd.setParent(this),this._curItem.cmd.redo()):(this._curItem={cmd:this.getCmdByCode([t[0],0].join(".")),cur:[t[0],0],curCmd:null,go:i-e[1]},this._curItem.curCmd=this._curItem.cmd,this._curItem.cmd.setParent(this),this._curItem.cmd.redo())},n.prototype._checkGoto=function(t){var e=[this._goto[0],this._goto[1]];if("number"==typeof t){if(t<0){var i=this._cur[1]+t;i<0?(e[0]+=i,e[1]=0):e[1]=i}else if(t>0){var i=e[0]+t-this._first[0];i>=0?(e[0]=this._first[0],e[1]+=i):e=[e[0]+t,0]}}else{var n=t.split(".");e=[parseInt(n[0]),parseInt(n[1])]}return this._cur.join(".")==this._last.join(".")&&(e[0]<this._last[0]||e[1]<this._last[1])?null:(e[0]>this._first[0]&&(e[0]=this._first[0]),e[0]<this._last[0]&&(e[0]=this._last[0]),e[0]==this._first[0]?e[1]>this._first[1]?e[1]=this._first[1]:e[1]<this._last[1]&&(e[1]=this._last[1]):e[1]=0,e)},n.prototype.next=function(){if(!this._curItem)if(this._cur.join(".")!=this._goto.join("."))this._executeGoto();else{var t=this._cache.shift();if(t instanceof D)this._curItem={cmd:t,cur:null,curCmd:null,go:0},t.setParent(this),t.execute();else if(t){var i=this._checkGoto(t);i?(this._goto=i,this.next()):(this._cache=[],this.dispatch(new C(e.CmdEvent.Overflow)))}else this.dispatch(new C(e.CmdEvent.Complete))}},n}(g);e.History=U,e.initHistory=d;var L;p(window,"resize",function(t){L||(L=setTimeout(function(){L=null,e.application.eachDialogChildren(function(e){e.onWindowResize(t)},!0)},100))}),e.setConfig=f;var A;e.getTopDialog=v});